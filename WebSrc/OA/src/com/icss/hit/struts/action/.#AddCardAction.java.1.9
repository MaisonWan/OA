/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.icss.hit.struts.action;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.icss.hit.bean.CardBean;
import com.icss.hit.bean.interfaces.CardDao;
import com.icss.hit.hibernate.vo.Card;
import com.icss.hit.hibernate.vo.CardType;
import com.icss.hit.hibernate.vo.SysUser;
import com.icss.hit.struts.form.AddCardForm;

/** 
 * 添加新的名片
 * Creation date: 08-06-2009
 * @author sdf
 * XDoclet definition:
 * @struts.action path="/addCard" name="addCardForm" input="/card/addCard.jsp" scope="request" validate="true"
 */
public class AddCardAction extends Action {
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		AddCardForm addCardForm = (AddCardForm) form;// TODO Auto-generated method stub
		//实例化一个用户
		long userId = 1L;
		if( request.getSession().getAttribute("UserId") != null ){
			userId = Long.parseLong(request.getSession().getAttribute("UserId").toString());
		}else{
			return mapping.findForward("NullLogin");
		}
		
		CardDao cd = new CardBean();
		// 实例化一个名片
		Card card = new Card();	
		card.setCdName(addCardForm.getCd_name());
		card.setCdCellphone(addCardForm.getCd_cellphone());
		card.setCdCompany(addCardForm.getCd_company());
		card.setCdEmail(addCardForm.getCd_email());
		card.setCdFax(addCardForm.getCd_fax());
		card.setCdInfos(addCardForm.getCd_info());
		card.setCdTel(addCardForm.getCd_tel());
		card.setCdPosition(addCardForm.getCd_position());
		card.setCdShare(addCardForm.getCd_share());
		card.setCdSex(addCardForm.getCd_sex());
		//实例化一个名片夹分类
		CardType ct = new CardType();
		ct.setCtId(Long.parseLong(addCardForm.getCt_name()));	
		SysUser user = new SysUser();
		user.setSuId(userId);
		ct.setSysUser(user);
		card.setCardType(ct);
		if(cd.addCard(card))
		{
			return mapping.findForward("AddCard.succeed");
		}
		else
		{
			return mapping.findForward("AddCard.faild");
		}
	}
}